<launch>
  <!-- RRTX + 四足动力学可视化：与 rrtx.launch 相同的规划，但用 legged 仿真与 B-spline 轨迹 -->
  <arg name="max_vel" default="2.0" />
  <arg name="max_acc" default="2.0" />
  <arg name="map_x_size" default="20.0" />
  <arg name="map_y_size" default="30.0" />
  <arg name="planning_height" default="0.4" doc="Robot init z / planning height (meters)" />
  <arg name="robot_type" default="zsl-1" doc="Robot type: zsl-1 (智身) or go2 (宇树)" />
  <arg name="rviz" default="true" />

  <!-- ============== Base Environment (四足版) ============== -->
  <!-- Provides: map_loader, odom simulator (with gait dynamics), local_sensing, gait_joint_publisher -->
  <include file="$(find nav_exp_env)/base_env/launch/nav_env_legged.launch">
    <arg name="rviz" value="false" />
    <arg name="use_click_pos_cmd" value="false" />
    <arg name="map_x_size" value="$(arg map_x_size)" />
    <arg name="map_y_size" value="$(arg map_y_size)" />
    <arg name="planning_height" value="$(arg planning_height)" />
    <arg name="robot_type" value="$(arg robot_type)" />
  </include>

  <!-- ============== RRTx Planner ============== -->
  <node pkg="rrtx_planner" type="rrtx_node.py" name="rrtx_planner" output="screen">
    <param name="epsilon" value="1.0" />
    <param name="ball_radius" value="2.5" />
    <param name="sensing_radius" value="5.0" />
    <param name="max_samples" value="8000" />
    <param name="build_rate" value="500" />
    <param name="move_rate" value="2.0" />
    <param name="goal_reach_thresh" value="0.5" />
    <param name="obstacle_cost" value="1000000.0" />
    <param name="robot_radius" value="0.3" />
    <param name="goal_bias" value="0.15" />
    <param name="online_samples" value="30" />
  </node>

  <!-- ============== RRTX 专用 B-spline（轨迹终点速度 0） ============== -->
  <node pkg="nav_exp_env" type="rrtx_traj_cmd.py" name="rrtx_traj_cmd" output="screen">
    <param name="path_topic" value="/planning/raw_path" />
    <param name="max_vel" value="$(arg max_vel)" />
    <param name="max_acc" value="$(arg max_acc)" />
    <param name="publish_rate" value="50.0" />
    <param name="fixed_z" value="$(arg planning_height)" />
    <param name="lookahead_dist" value="0.3" />
  </node>

  <!-- ============== RViz (四足可视化) ============== -->
  <node if="$(arg rviz)" pkg="rviz" type="rviz" name="rviz_visualization" output="screen"
        args="-d $(find nav_exp_env)/rrtx/config/rrtx.rviz -f odom" />
</launch>
