# Position to Velocity Controller Configuration
# 位置到速度转换控制器配置 - 四足机器人优化版

# ==================== PID控制器参数 ====================
# 注意：四足机器人X方向（前进）和Y方向（侧移）能力差异大
# X方向能力强 (~1.0 m/s)，Y方向能力弱 (~0.4 m/s)

# X方向（前进/后退）PID参数
kp_x: 2.0         # X位置比例增益 (建议: 1.0-2.0)
ki_x: 0.0         # X位置积分增益 (建议: 0.0-0.2)
kd_x: 0.0         # X位置微分增益 (建议: 0.2-0.5)

# Y方向（侧移）PID参数 - 需要更强的控制
kp_y: 2.0         # Y位置比例增益 (建议: 2.5-4.0) 【关键：Y能力弱，需要更大增益】
ki_y: 0.0         # Y位置积分增益 (建议: 0.2-0.5) 【关键：补偿累积误差】
kd_y: 0.6         # Y位置微分增益 (建议: 0.4-0.8) 【关键：防止震荡】

# Z方向和航向
kp_z: 0.0         # Z位置比例增益 (四足机器人不控制Z)
kp_yaw: 0.5       # 航向比例增益 (建议: 1.5-2.5) 【跟踪规划器的航向角】

# ==================== 速度限制 ====================
# 根据GO2实际能力设置

max_linear_vel_x: 2.0   # X方向最大速度 (m/s)
max_linear_vel_y: 1.0    # Y方向最大速度 (m/s) 【关键：限制侧移速度】
max_angular_vel_z: 3.0   # 最大转向速度 (rad/s) 【增强转向能力】

# ==================== 控制模式 ====================
# 'feedforward': 直接使用规划器速度 (响应快，但Y方向会偏离)
# 'feedback': 纯反馈控制 (精确，但响应稍慢)
# 'hybrid': 前馈+反馈 (推荐，X和Y可以不同权重)

control_mode: 'feedback'    # 推荐使用混合模式

# ==================== 混合模式权重 ====================
# X和Y方向使用不同权重以适应四足运动学特性

# X方向权重（前进能力强，可以跟随规划）
feedforward_weight_x: 0.8   # 80%使用规划速度
feedback_weight_x: 0.2      # 20%用于误差修正

# Y方向权重（侧移能力弱，主要靠反馈修正）
feedforward_weight_y: 0.3   # 30%使用规划速度 【关键：减少跟随】
feedback_weight_y: 0.7      # 70%用于误差修正 【关键：强化反馈】

# ==================== 其他参数 ====================

# 位置容差
position_tolerance: 0.1   # 位置容差 (米)，小于此值时停止积分

# 四足机器人特性
ignore_z: true            # 忽略Z轴控制（四足在地面运动）

# 控制频率
control_rate: 50.0       # Hz (建议: 50-100)

# 调试模式
debug: true               # 显示实时误差和速度命令

# ==================== 参数调优建议 ====================
#
# ★ 如果Y方向偏差大（>0.3m）- 最常见问题：
#   - 增大 kp_y 到 4.0
#   - 增大 ki_y 到 0.3-0.5（启用积分补偿）
#   - 减小 feedforward_weight_y 到 0.1（更依赖反馈）
#   - 检查是否"yaw转过去了但xy还没到" → 自适应yaw控制会自动处理
#
# 如果Y方向震荡：
#   - 增大 kd_y 到 0.8
#   - 减小 kp_y 到 2.5
#   - 减小 ki_y 到 0.0（禁用积分）
#
# 如果整体跟踪慢：
#   - 增大 kp_x 和 kp_y
#   - 增大 feedforward_weight_x
#
# 如果运动抖动：
#   - 增大 kd_x 和 kd_y
#   - 减小 kp_x 和 kp_y
#
# ★ 如果yaw转向太快导致位置偏离：
#   - 已启用自适应yaw控制，位置误差大时会自动降低yaw增益
#   - 如果仍然太快，降低 kp_yaw 到 1.0
#   - 自适应阈值硬编码在代码中（>15cm开始衰减）
#


